### Проект 03: Автоматическая система кормления

![Img](./media/3-0.webp)

#### 1. Описание

Автоматическая система кормления состоит из основной платы kidsIOT, ультразвукового датчика и сервопривода. Ультразвуковой датчик используется для определения расстояния до питомца в зоне кормления. Когда животное приближается к миске с кормом, датчик фиксирует уменьшение расстояния. После срабатывания сигнала система управляет сервоприводом, который открывает кормовой отсек и автоматически подаёт корм животным.

#### 2. Компоненты

|![Img](./media/A1.png)|![Img](./media/A6.png)|![Img](./media/A7.png)|![Img](./media/A14.png)|
| :--: | :--: | :--: | :--: |
|Основная плата kidsIOT×1|Плата-адаптер ультразвукового датчика×1|Ультразвуковой датчик×1|Сервопривод×1|
|![Img](./media/A21.png)|![Img](./media/A19.png)|![Img](./media/A32.png)| |
|Провод×1|USB-кабель×1| LEGO-элементы автоматической системы кормления×1 | |

![Img](./media/3-1.png)

#### 3. Этапы сборки

##### Шаг 1：Необходимые компоненты

![Img](./media/Z-3-1.png)

##### Шаг 2：Процесс сборки

Процесс 1：

![Img](./media/Z-3-2.png)

Процесс 2：

![Img](./media/Z-3-3.png)

Процесс 3：

![Img](./media/Z-3-4.png)

Процесс 4：

![Img](./media/Z-3-5.png)

Процесс 5：

![Img](./media/Z-3-6.png)

Процесс 6：

![Img](./media/Z-3-7.png)

Процесс 7：

![Img](./media/Z-3-8.png)

Процесс 8：

![Img](./media/Z-3-9.png)

Процесс 9：

![Img](./media/Z-3-10.png)

Процесс 10：

![Img](./media/Z-3-11.png)

Процесс 11：

![Img](./media/Z-3-12.png)

Процесс 12：

![Img](./media/Z-3-13.png)

Процесс 13：

![Img](./media/Z-3-14.png)

Процесс 14：

![Img](./media/Z-3-15.png)

Процесс 15：

![Img](./media/Z-3-16.png)

Процесс 16：Инициализация угла сервопривода

Подключение сервопривода  
![Img](./media/Z-3-17.png)

Сначала напишите следующий код в программе KidsBlock и загрузите его в основную плату kidsIOT. После этого сервопривод повернётся на 190°.  
(<span style="color: rgb(255, 76, 65);">Примечание: если сервопривод не вращается, нажмите кнопку RESET на плате kidsIOT.</span>)

![Img](./media/Z-3-18.png)

Процесс 17：

![Img](./media/Z-3-19.png)

Процесс 18：

![Img](./media/Z-3-20.png)

Процесс 19：

(<span style="color: rgb(255, 76, 65);">Примечание: не проворачивайте сервопривод вручную</span>)

![Img](./media/Z-3-21.png)

Процесс 20：

![Img](./media/Z-3-22.png)

Процесс 21：

![Img](./media/Z-3-23.png)

Готово

![Img](./media/Z-3-24.png)

#### 4. Схема подключения

| Модуль | Основная плата kidsIOT |
| :--: | :--: |
| Плата-адаптер ультразвукового датчика | Порт №9（Trig — io18，Echo — io19） |
|Сервопривод|Порт G/V/io33（Коричневый→G，Красный→V，Оранжевый→io33）|

| Ультразвуковой датчик | Плата-адаптер |
| :--: | :--: |
| Vcc | VCC |
| Trig | Trig |
| Echo | Echo |
| Gnd | GND |

Подключите основную плату kidsIOT к компьютеру с помощью USB-кабеля.

![Img](./media/3-2.png)

#### 5. Вращение сервопривода

![Img](./media/3-3.png)

##### (1). Шаги программирования

###### Шаг 1：Описание блока

![Img](./media/1-38.png)

Этот блок задаёт канал сервопривода и угол поворота (выходной сигнал) на указанном PWM-пине.

###### Шаг 2：Напишите программу

① Установите пин IO33 (<span style="color: rgb(255, 76, 65);">управляющий пин io33</span>), подключённый к сервоприводу, в режим "**Output**".

![Img](./media/3-5.png)

② Инициализируйте управляющий канал сервопривода как CH2 (LT1) и задайте начальный угол <span style="color: rgb(255, 76, 65);">190°</span> с задержкой 0,5 секунды.

![Img](./media/3-6.png)

③ Сервопривод поворачивается с 190° на 120°, затем на 60° каждые 0,5 секунды.

![Img](./media/3-7.png)

④ Полная программа

![Img](./media/3-8.png)

##### (2). Результат тестирования

Нажмите ![Img](./media/1-27.png), чтобы загрузить полный код в основную плату kidsIOT. После подачи питания через USB-кабель сервопривод начнёт вращаться.

#### 6. Считывание значения ультразвукового датчика

![Img](./media/3-10.png)

##### (1). Шаги программирования

###### Шаг 1：Добавьте ультразвуковой датчик

Выберите модуль “Sensor” в разделе “Extension”, затем выберите “**Ultrasonic Sensor**” и нажмите ![Img](media/781.png), чтобы вернуться к интерфейсу программирования.

![Img](./media/3-13.png)

![Img](./media/3-14.png)

![Img](./media/3-15.png)

###### Шаг 2：Описание блока

![Img](./media/3-16.png)

Этот блок используется для измерения расстояния до указанного пина. Единицы измерения — сантиметры или дюймы.

###### Шаг 3：Напишите программу

① Установите скорость передачи данных (baud rate) 15200.

![Img](./media/1-68.png)

② Установите пин Trig ультразвукового датчика <span style="color: rgb(255, 76, 65);">IO18</span> в режим "**output**", а пин Echo <span style="color: rgb(255, 76, 65);">IO19</span> — в режим "**input**".

![Img](./media/3-18.png)

③ Укажите Trig = <span style="color: rgb(255, 76, 65);">IO18</span> и Echo = <span style="color: rgb(255, 76, 65);">IO19</span>, и выводите измеренное расстояние в последовательный порт каждые 0,1 секунды.

![Img](./media/3-19.png)

④ Полная программа

![Img](./media/3-20.png)

##### (2). Результат тестирования

Нажмите ![Img](./media/1-27.png), чтобы загрузить полный код в основную плату kidsIOT. После подачи питания через USB-кабель нажмите ![Img](./media/1-87.png) в мониторе порта и установите скорость 15200.  
Поднесите руку к ультразвуковому датчику: при приближении отображаемое расстояние уменьшается, при удалении — увеличивается.

![Img](./media/3-23.png)

#### 7. Автоматическая система кормления

![Img](./media/3-24.png)

##### (1). Шаги программирования

###### Шаг 1：Блок-схема

![Img](./media/3-25.png)

###### Шаг 2：Программирование

① Установите скорость 15200, пин Trig ультразвукового датчика <span style="color: rgb(255, 76, 65);">IO18</span> в режим "**output**", а пин Echo <span style="color: rgb(255, 76, 65);">IO19</span> — в режим "**input**".

![Img](./media/3-26.png)

② Установите пин IO33, подключённый к сервоприводу, в режим "**Output**", инициализируйте канал CH2 (LT1) и задайте начальный угол <span style="color: rgb(255, 76, 65);">190°</span> с задержкой 0,5 секунды.

![Img](./media/3-27.png)

③ Определите глобальную переменную "<span style="color: rgb(255, 76, 65);">Distance</span>" для хранения значения расстояния, измеренного ультразвуковым датчиком.

![Img](./media/3-28.png)

④ Задайте пины Trig и Echo ультразвукового датчика и выведите измеренное расстояние в последовательный порт.

![Img](./media/3-29.png)

⑤ Определите расстояние: если 2 см < значение расстояния < 7 см — кормовой отсек открывается; в противном случае он остаётся закрытым.

![Img](./media/3-30.png)

⑥ Полная программа

![Img](./media/3-31.png)

##### (2). Результат тестирования

Нажмите ![Img](./media/1-27.png), чтобы загрузить полный код в основную плату kidsIOT. После подачи питания через USB-кабель нажмите ![Img](./media/1-87.png) в мониторе порта и установите скорость 15200.  
Если животное обнаружено на расстоянии 2–9 см, кормовой отсек откроется и произойдёт кормление.

![Img](./media/3-34.jpg)

#### 8. Частые проблемы　

##### Q1: Почему сервопривод не работает?

A: Возможно, он заедает. Перед сборкой сервопривода используйте код для установки его угла на 80°.

##### Q2: Почему расстояние, измеренное ультразвуковым датчиком, неточное?

A: Измерение следует начинать от излучающей головки ультразвукового датчика. Данный модуль не является высокоточным и может иметь погрешности.

![Img](./media/3-34.png)
