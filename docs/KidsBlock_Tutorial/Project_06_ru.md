### Проект 06：Система контроля температуры и влажности

![Img](./media/6-0.png)

#### 1. Описание

В этом проекте показано, как с помощью основной платы kidsIOT, датчика температуры и влажности, вентилятора и OLED-дисплея собрать интеллектуальную систему контроля температуры и влажности.

Система измеряет температуру и влажность окружающей среды и управляет вентилятором для охлаждения и осушения воздуха по мере необходимости. Когда температура или влажность превышают заданный порог, система автоматически включает вентилятор, чтобы снизить температуру или влажность в среде ниже установленного значения и тем самым защитить животных и растения на ферме.

Кроме того, система позволяет регулировать пороговые значения температуры и влажности и отображать их на OLED-дисплее.


#### 2. Компоненты

|![Img](./media/A1.png)|![Img](./media/A11.png)|![Img](./media/A12.png)| ![Img](./media/A21.png)|![Img](./media/A20.png)|
| :--: | :--: | :--: |:--: |:--: |
|Основная плата kidsIOT×1|Двигатель×1|Датчик температуры и влажности×1|Провода×2|Держатель батарей×1|
|![Img](./media/A27.png)|![Img](./media/A19.png)|![Img](./media/A34.png)|![Img](./media/A28.png) | |
|Вентилятор×1|USB-кабель×1| Temperature and Humidity System LEGO Pieces×1 | AA Battery（<span style="color: rgb(255, 76, 65);">Not provide</span>）×6 | |

![Img](./media/6-1.png)

#### 3. Шаги сборки

##### Шаг 1：Необходимые компоненты

![Img](./media/Z-6-1.png)

##### Шаг 2：Процесс

Процесс 1：

![Img](./media/Z-6-2.png)

Процесс 2：

![Img](./media/Z-6-3.png)

Процесс 3：

![Img](./media/Z-6-4.png)

Процесс 4：

![Img](./media/Z-6-5.png)

Готово：

![Img](./media/Z-6-6.png)

#### 4. Схема подключения

| Модуль |kidsIOT Mainboard |
| :--: | :--: |
| Датчик температуры и влажности |Порт №6（управляющий пин — io23） |
|Двигатель|Порт №9（IN+ управляющий пин — io18，IN− управляющий пин — io19）|

Подключите основную плату kidsIOT к компьютеру через USB-кабель, подключите внешний источник питания и переведите DIP-переключатель на плате в положение ON.

![Img](./media/6-2.png)

#### 5. OLED-дисплей

![Img](./media/6-3.png)

##### (1). Шаги программирования

###### Шаг 1：Описание блоков

![Img](./media/6-4.png)

Этот блок используется для инициализации ширины, высоты и I2C-адреса OLED-дисплея.

![Img](./media/6-5.png)

Этот блок-команда рисует прямую линию от начальной позиции x0:0 y0:0 до конечной позиции x1:32 y1:16. Числа в блоке можно менять.

![Img](./media/6-6.png)

Этот блок-команда рисует прямоугольник шириной 32 и высотой 16, начиная с позиции x:0 y:0. Числа можно менять.

![Img](./media/6-7.png)

Этот блок-команда рисует закрашенный прямоугольник шириной 32 и высотой 16, начиная с позиции x:0 y:0. Числа можно менять.

![Img](./media/6-8.png)

Этот блок-команда рисует окружность радиусом 8, начиная с позиции x:16 y:16.

![Img](./media/6-9.png)

Этот блок-команда рисует закрашенную окружность радиусом 8, начиная с позиции x:16 y:16.

![Img](./media/6-10.png)

Этот блок-команда рисует прямоугольник со скруглёнными углами шириной 32, высотой 16 и радиусом 4, начиная с позиции x:16 y:16.

![Img](./media/6-11.png)

Этот блок-команда рисует закрашенный прямоугольник со скруглёнными углами шириной 32, высотой 16 и радиусом 4, начиная с позиции x:16 y:16.

![Img](./media/6-12.png)

Этот блок-команда рисует треугольник по трём точкам x0:0 y0:0, x1:16 y1:0 и x2:8 y2:16.

![Img](./media/6-13.png)

Этот блок-команда закрашивает треугольник между тремя точками x0:0 y0:0, x1:16 y1:0 и x2:8 y2:16.

![Img](./media/6-14.png)

Этот блок-команда задаёт размер текста, цвет текста и цвет фона.

![Img](media/6-15.png)

Этот блок-команда задаёт позицию курсора.

![Img](./media/6-16.png)

Этот блок задаёт способ печати строк на OLED-экране. “**warp**” означает печать с переносом строки, “**no-warp**” — печать без переноса строки.

![Img](./media/6-17.png)

Этот блок-команда задаёт режим отображения OLED.

![Img](./media/6-18.png)

Этот блок-команда очищает экран OLED.

![Img](./media/6-19.png)

Этот блок-команда обновляет экран OLED и отображает следующий контент.

![Img](./media/6-20.png)

Этот блок-команда задаёт прокрутку строк в определённом направлении.

![Img](./media/6-21.png)

Этот блок-команда останавливает прокрутку.

###### Шаг 2：Напишите программу

① Инициализируйте OLED с шириной 128, высотой 64 и I2C-адресом 0x78 (0x3c).

![Img](./media/6-22.png)

② Установите размер текста 6x8, цвет текста — белый, цвет фона — чёрный.

![Img](./media/6-23.png)

③ OLED отображает прямые линии.

![Img](./media/6-24.png)

④ OLED отображает прямую линию и делает задержку 1 секунду.

![Img](./media/6-25.png)

⑤ OLED отображает прямоугольник и делает задержку 1 секунду.

![Img](./media/6-26.png)

⑥ OLED отображает закрашенный прямоугольник и делает задержку 1 секунду.

![Img](./media/6-27.png)

⑦ OLED отображает окружность и делает задержку 1 секунду.

![Img](./media/6-28.png)

⑧ OLED отображает закрашенную окружность и делает задержку 1 секунду.

![Img](./media/6-29.png)

⑨ OLED отображает скруглённый прямоугольник и делает задержку 1 секунду.

![Img](./media/6-30.png)

⑩ OLED отображает закрашенный скруглённый прямоугольник и делает задержку 1 секунду.

![Img](./media/6-31.png)

⑪ OLED отображает треугольник и делает задержку 1 секунду.

![Img](./media/6-32.png)

⑫ OLED отображает закрашенный треугольник и делает задержку 1 секунду.

![Img](./media/6-33.png)

⑬ OLED отображает улыбающееся лицо и делает задержку 1 секунду.

![Img](./media/6-34.png)

⑭ OLED отображает сердитое лицо и делает задержку 1 секунду.

![Img](./media/6-35.png)

⑮ OLED отображает плачущее лицо и делает задержку 1 секунду.

![Img](./media/6-36.png)

⑯ OLED отображает “↑” и делает задержку 1 секунду.

![Img](./media/6-37.png)

⑰ OLED отображает “↓” и делает задержку 1 секунду.

![Img](./media/6-38.png)

⑱ OLED отображает “←” и делает задержку 1 секунду.

![Img](./media/6-39.png)

⑲ OLED отображает “→” и делает задержку 1 секунду.

![Img](./media/6-40.png)

⑳ OLED отображает “❤” и делает задержку 1 секунду.

![Img](./media/6-41.png)

㉑ Установите позицию курсора OLED и выведите строку "Hello, KidsBlock" в точке x:0 y:30, затем задержка 1 секунду.

![Img](./media/6-42.png)

㉒ Полная программа

![Img](./media/6-43.png)

##### (2). Результат тестирования

Нажмите![Img](./media/1-27.png), чтобы загрузить приведённый полный код в основную плату kidsIOT. После подачи питания от внешнего источника питания OLED-дисплей на плате kidsIOT отображает разные рисунки и английские буквы.


#### 6. Вентилятор вращается

![Img](./media/6-45.png)

##### (1). Шаги программирования

###### Шаг 1：Добавьте “DC Motor” 

Нажмите ![Img](./media/6-46.png), выберите модуль “Actuator” в разделе “Extension”, затем выберите “**<span style="color: rgb(255, 76, 65);">DC Motor for esp32</span>**” и нажмите ![Img](media/781.png), чтобы вернуться к интерфейсу программирования.

![Img](./media/6-48.png)

![Img](./media/6-49.png)

![Img](./media/6-50.png)

###### Шаг 2：Описание блоков

![Img](./media/6-51.png)

Задаёт высокий/низкий уровень на пинах INA и INB двигателя.

![Img](./media/6-52.png)

Задаёт высокий/низкий уровень на пине INA и значение аналогового выхода на пине INB в выбранных каналах.
Если INA находится в состоянии высокого уровня, то чем меньше аналоговое значение INB, тем быстрее вращается вентилятор; если INA в состоянии низкого уровня, то чем больше аналоговое значение INB, тем быстрее вращается вентилятор.

###### Шаг 3：Напишите программу

① Пин INA модуля двигателя — IO18, уровень — low; пин INB — IO19; канал — CH0 (LT0); аналоговое значение — 0. В этом случае двигатель не вращается.

![Img](./media/6-53.png)

② Установите INA в состояние low и задайте разные значения аналогового выхода INB — двигатель будет вращаться по часовой стрелке с разной скоростью.

![Img](./media/6-54.png)

③ Остановите двигатель на 3 секунды.

![Img](./media/6-55.png)

④ Установите INA в состояние high и задайте разные значения аналогового выхода INB — двигатель будет вращаться против часовой стрелки с разной скоростью.

![Img](./media/6-56.png)

⑤ Остановите двигатель на 3 секунды.

![Img](./media/6-57.png)

⑥ Полная программа

![Img](./media/6-58.png)

##### (2). Результат тестирования

Нажмите![Img](./media/1-27.png), чтобы загрузить приведённый полный код в основную плату kidsIOT. После подачи питания от внешнего источника двигатель вращается по часовой стрелке с разной скоростью и останавливается на 3 секунды, затем вращается против часовой стрелки с разной скоростью и снова останавливается на 3 секунды.

#### 7. Считывание данных с датчика температуры и влажности

![Img](./media/6-60.png)

##### (1). Шаги программирования

###### Шаг 1：Добавьте “temperature and humidity sensor” 

Нажмите ![Img](./media/6-46.png), выберите модуль “Sensor” в разделе “Extension”, затем выберите “**<span style="color: rgb(255, 76, 65);">DHT sensor for esp32</span>**” и нажмите ![Img](media/781.png), чтобы вернуться к интерфейсу программирования.

![Img](./media/6-63.png)

![Img](./media/6-64.png)

![Img](./media/6-65.png)

###### Шаг 2：Описание блоков

![Img](./media/6-66.png)

Инициализация пина и режима датчика температуры и влажности (dht11, dht21 или dht22).

![Img](./media/6-67.png)

Чтение температуры и влажности с датчика.

###### Шаг 3：Напишите программу

① Установите скорость (baud rate) 15200.

![Img](./media/1-68.png)

② Инициализируйте пин IO23 датчика температуры и влажности и выберите режим dht11.

![Img](./media/6-69.png)

③ Каждую 1 секунду выводите в последовательный порт считанные значения температуры и влажности текущей среды.

![Img](./media/6-70.png)

④ Полная программа

![Img](./media/6-71.png)

##### (2). Результат тестирования

Нажмите![Img](./media/1-27.png), чтобы загрузить приведённый полный код в основную плату kidsIOT. После подачи питания через USB-кабель нажмите ![Img](./media/1-87.png) в мониторе порта и установите скорость 15200. Затем в последовательный порт будут выводиться значения температуры и влажности текущей среды.

![Img](./media/6-74.png)

#### 8. Система контроля температуры и влажности

![Img](./media/6-75.png)

##### (1). Шаги программирования

###### Шаг 1：Блок-схема

![Img](./media/6-76.png)

###### Шаг 2：Напишите программу

① Инициализируйте пин IO23 датчика температуры и влажности и выберите режим dht11.

![Img](./media/6-77.png)

② Инициализируйте ширину, высоту, I2C-адрес, размер и цвет текста, а также цвет фона OLED-дисплея.

![Img](./media/6-78.png)

③ Задайте строки "Temper:" и "Humid:" для отображения на OLED.

![Img](./media/6-79.png)

④ Определите переменные "**temperature**" и "**humidity**".

![Img](./media/6-80.png)

⑤ Сохраните считанные <span style="color: rgb(255, 76, 65);">данные температуры</span> в переменную "temperature". Считанные <span style="color: rgb(255, 76, 65);">данные влажности</span> сохраните в переменную "humidity".

![Img](./media/6-81.png)

⑥  Отобразите <span style="color: rgb(255, 76, 65);">данные температуры</span> и <span style="color: rgb(255, 76, 65);">данные влажности</span> в соответствующей позиции на OLED.

![Img](./media/6-82.png)

⑦ Определите значения температуры и влажности, измеренные датчиком. Когда температура больше 29°C или влажность больше 80%RH, вентилятор будет включён.

![Img](./media/6-83.png)

⑧ Полная программа

![Img](./media/6-84.png)

##### (2). Результат тестирования

Нажмите![Img](./media/1-27.png) чтобы загрузить приведённый полный код в основную плату kidsIOT. После подачи питания от внешнего источника OLED показывает температуру и влажность текущей среды.

Когда температура достигает 29°C или влажность достигает 80%RH, двигатель включается для отвода тепла или осушения (вентилятор имитирует теплоотвод и осушение, эффект теплоотвода и осушения средний); иначе двигатель выключается, обеспечивая автоматический эффект контроля температуры и влажности на ферме.

![Img](./media/6-86.jpg)

#### 9. Частые проблемы　

##### Q1: Влагозащищён ли датчик температуры и влажности?

A: Датчик измеряет температуру и влажность в воздухе и не является водонепроницаемым. Пожалуйста, не погружайте модуль в воду.

##### Q2: Вызывает ли вращение двигателя перезагрузку основной платы kidsIOT?

A: При вращении двигатель требует больший ток, чем другие датчики, что вызывает колебания напряжения и тока в цепи. Особенно при реверсе (вперёд/назад) колебания напряжения и тока слишком велики — напряжение питания основной платы kidsIOT может просесть, из-за чего происходит перезагрузка.
